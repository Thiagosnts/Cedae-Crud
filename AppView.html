<style>
    #searchResult li:nth-child(2n+1) {
        background: #f7f7f7;
        width: 100%;
    }
    #searchResult li .more {
    font-family: Conv_HelveticaNeueLTPro-Bd;
    display: block;
    color: #0072bc;
    font-size: 18px;
    position: relative;
    float: left;
    width: 100%;
    height: 36px;
    line-height: 36px;
}
.listaConc{
text-indent: inherit!important;}

.styledSelect, .select-options {
   display: none!important;
}


</style>



<div class="wrapper">

    
    <div class="filter-tp5 filter">
        <div class="form_inner"> <span id="searchFormMap" action="" class="">
                <div class="row"> <label></label>
                    <div class="select">
                        <div class="select-inside">
                            <select onchange="carregarItens()" class="listaConc"
                                id="" name="">
                                <option value="0">-- CONCESSIONÁRIAS --</option>
                            </select>
                        </div>
                       
                    </div>
                </div>
        </div>
        <div class="wrap-buscar">
            <div class="row"> <label>Buscar</label> <input name="" type="text" id="busca"
                    placeholder="Buscar Cidade"></div>
            <div class="row submit"> <input onclick="carregarItens(document.getElementById('busca').value);return false"
                    type="submit" name="" value="OK" id="">
            </div>
        </div>
        </span>
    </div>

    <ul id="searchResult">
        <!-- <li class="active">
                <h4 class="local-name">BELFORD ROXO</h4> <span class="adress"><b>Bairro: </b>Campo Grande</span><a class="more-info" href="0">Mais informações</a>
            </li>
            <li class="">
                <h4 class="local-name">DUQUE DE CAXIAS</h4> <span class="adress"><b>Bairro: </b>Av. Dr. Manoel Teles,
                    237</span><a class="more-info" href="1">Mais informações</a>
            </li> -->
    </ul>
</div>






<script>
    var dadosJson;

    $(window).load(function () {
        getDados() 
        console.log("carregou itens...")
    });


    function getDados() {
        $.ajax({
            url: 'https://teste.cedae.com.br/portals/0/sc/concessao/AppListaBack.aspx',
            cache: false,
            type: "POST",
            success: function (response) {

                dadosJson = JSON.parse(response);
                carregarLista()
                carregarItens()

            },
            error: function () {
                alert('deu ruim')
            }
        })
    }

    function carregarLista() {
        var listaConc = document.getElementsByClassName('listaConc')[0]
        for (var i = 0; i < dadosJson.Concessionarias.length; i++) {
            var itemLista = document.createElement("option")
            itemLista.value = dadosJson.Concessionarias[i]
            itemLista.innerHTML = dadosJson.Concessionarias[i].toUpperCase()
            listaConc.appendChild(itemLista)
        }
    }

    function carregarItens(cidade) {
        limparItens();
        var modeloItens = '<h4 class="local-name">#CIDADE#</h4> <span class="adress"><b>Bairro: </b>#BAIRRO#</span><span style="display:block" class="more" href="1">#EMPRESA#</span>'
        var listaItens = document.getElementById('searchResult')

        var itemJson = filtraRegiao(cidade)
        var item;

        var aux;
        for (var i = 0; i < itemJson.length; i++) {
            item = document.createElement('li')
            aux = modeloItens.replace('#BAIRRO#', itemJson[i].Bairro);
            aux = aux.replace('#CIDADE#', itemJson[i].Cidade);
            aux = aux.replace('#EMPRESA#', itemJson[i].Concessionaria);

            

            item.innerHTML = aux
            listaItens.appendChild(item)

        }
    }

    function limparItens() {
        var listaItens = document.getElementById('searchResult')
        var tamanhoLista = listaItens.children.length;

        for (var i = 0; i < tamanhoLista; i++)
            listaItens.removeChild(listaItens.children[0])
    }

    function filtraRegiao(cidade) {
        var regiao = document.getElementsByClassName('listaConc')[0].value
        var lista = dadosJson.item

        listaAtualizada = []

        if (cidade)
            return buscarCidade(lista, cidade)

        for (var i = 0; i < lista.length; i++) {
            if (lista[i].Concessionaria == regiao)
                listaAtualizada.push(lista[i])
               
        }

        if (regiao == 0)
            listaAtualizada = lista
        
        return listaAtualizada
    }

    function buscarCidade(lista, cidade) {
        listaAtualizada = []
        console.log(cidade)
        for (var i = 0; i < lista.length; i++) {
            if (lista[i].Cidade == cidade)
                listaAtualizada.push(lista[i])
        }

        return listaAtualizada
    }

    function solicitarDadosMock() {
        var dadosString = '{ "Concessionarias": [ "Sanepar", "Rio Aguas" ],"item": [ { "Concessionaria": "Sanepar", "Cidade": "Rio de janeiro", "Bairro": "Campo Grande" },{ "Concessionaria": "Rio Aguas", "Cidade": "Sao Paulo", "Bairro": "Capao Redondo" } ] }'
        dadosJson = JSON.parse(dadosString);
    }

</script>