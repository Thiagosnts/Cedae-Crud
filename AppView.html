<style>
    #searchResult li:nth-child(2n+1) {
        background: #f7f7f7;
    }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


<div class="wrapper">
    <div class="filter-tp5 filter">
        <div class="form_inner"> <span id="searchFormMap" action="../Upload/Files/Localizador/pontos.json" class="">
                <div class="row"> <label></label>
                    <div class="select">
                        <div class="select-inside">
                            <select onchange="carregarItens()" class="listaConc"
                                id="dnn_ctr685_View_ddlStoreLocatorRegion" name="dnn$ctr685$View$ddlStoreLocatorRegion">
                                <option value="0">-- TODAS REGIÕES --</option>
                            </select>
                        </div>
                       
                    </div>
                </div>
        </div>
        <div class="wrap-buscar">
            <div class="row"> <label>Buscar</label> <input name="dnn$ctr685$View$tbSubject" type="text" id="busca"
                    placeholder="Palavra-chave"></div>
            <div class="row submit"> <input onclick="carregarItens(document.getElementById('busca').value);return false"
                    type="submit" name="dnn$ctr685$View$btnSearch" value="OK" id="dnn_ctr685_View_btnSearch">
            </div>
        </div>
        </span>
    </div>
</div>
<ul id="searchResult">
    <!-- <li class="active">
            <h4 class="local-name">BELFORD ROXO</h4> <span class="adress"><b>Bairro: </b>Campo Grande</span><a class="more-info" href="0">Mais informações</a>
        </li>
        <li class="">
            <h4 class="local-name">DUQUE DE CAXIAS</h4> <span class="adress"><b>Bairro: </b>Av. Dr. Manoel Teles,
                237</span><a class="more-info" href="1">Mais informações</a>
        </li> -->
</ul>
</div>






<script>
    var dadosJson;
    window.onload = function ()  {

        getDados() 
    }

 
    function getDados() {
        $.ajax({
            url: 'AppListaBack.aspx',
            cache: false,
            type: "POST",
            success: function (response) {

                dadosJson = JSON.parse(response);
                carregarLista()
                carregarItens()

            },
            error: function () {
                alert('deu ruim')
            }
        })
    }

    function carregarLista() {
        var listaConc = document.getElementsByClassName('listaConc')[0]
        for (var i = 0; i < dadosJson.Concessionarias.length; i++) {
            var itemLista = document.createElement("option")
            itemLista.value = dadosJson.Concessionarias[i]
            itemLista.innerHTML = dadosJson.Concessionarias[i].toUpperCase()
            listaConc.appendChild(itemLista)
        }
    }

    function carregarItens(cidade) {
        limparItens();
        var modeloItens = '<h4 class="local-name">#CIDADE#</h4> <span class="adress"><b>Bairro: </b>#BAIRRO#</span><a class="more-info" href="1">Mais informações</a>'
        var listaItens = document.getElementById('searchResult')

        var itemJson = filtraRegiao(cidade)
        var item;

        var aux;
        for (var i = 0; i < itemJson.length; i++) {
            item = document.createElement('li')
            aux = modeloItens.replace('#BAIRRO#', itemJson[i].Bairro);
            aux = aux.replace('#CIDADE#', itemJson[i].Cidade);

            item.innerHTML = aux
            listaItens.appendChild(item)

        }
    }

    function limparItens() {
        var listaItens = document.getElementById('searchResult')
        var tamanhoLista = listaItens.children.length;

        for (var i = 0; i < tamanhoLista; i++)
            listaItens.removeChild(listaItens.children[0])
    }

    function filtraRegiao(cidade) {
        var regiao = document.getElementsByClassName('listaConc')[0].value
        var lista = dadosJson.item

        listaAtualizada = []

        if (cidade)
            return buscarCidade(lista, cidade)

        for (var i = 0; i < lista.length; i++) {
            if (lista[i].Concessionaria == regiao)
                listaAtualizada.push(lista[i])
               
        }

        if (regiao == 0)
            listaAtualizada = lista
        
        return listaAtualizada
    }

    function buscarCidade(lista, cidade) {
        listaAtualizada = []
        console.log(cidade)
        for (var i = 0; i < lista.length; i++) {
            if (lista[i].Cidade == cidade)
                listaAtualizada.push(lista[i])
        }

        return listaAtualizada
    }

    function solicitarDadosMock() {
        var dadosString = '{ "Concessionarias": [ "Sanepar", "Rio Aguas" ],"item": [ { "Concessionaria": "Sanepar", "Cidade": "Rio de janeiro", "Bairro": "Campo Grande" },{ "Concessionaria": "Rio Aguas", "Cidade": "Sao Paulo", "Bairro": "Capao Redondo" } ] }'
        dadosJson = JSON.parse(dadosString);
    }

</script>